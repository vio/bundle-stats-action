import flow from 'lodash/fp/flow';
import fromPairs from 'lodash/fp/fromPairs';
import get from 'lodash/fp/get';
import map from 'lodash/fp/map';
import _filter from 'lodash/fp/filter';
import pick from 'lodash/fp/pick';
import toPairs from 'lodash/fp/toPairs';
const PATH_IGNORE_PATTERN = '.map$';
export default (source, options = {}) => {
    var _a;
    const pathIgnorePattern = new RegExp(options.pathIgnorePattern || PATH_IGNORE_PATTERN);
    const builtAt = get('builtAt')(source);
    const hash = get('hash')(source);
    const assets = flow([
        get('assets'),
        map(pick(['name', 'size'])),
        _filter(({ name }) => name && !pathIgnorePattern.test(name)),
    ])(source);
    const entrypoints = flow([
        get('entrypoints'),
        toPairs,
        map(([key, value]) => [key, pick('assets')(value)]),
        fromPairs,
    ])(source);
    const chunks = flow([
        get('chunks'),
        map(pick(['id', 'entry', 'initial', 'files', 'names'])),
        _filter(({ id }) => id !== null && typeof id !== 'undefined'),
    ])(source);
    const modules = (_a = source === null || source === void 0 ? void 0 : source.modules) === null || _a === void 0 ? void 0 : _a.map(({ name, size, chunks: moduleChunks, modules: concatenatedModules }) => ({
        name,
        size,
        chunks: moduleChunks === null || moduleChunks === void 0 ? void 0 : moduleChunks.filter((chunkId) => chunkId !== null && typeof chunkId !== 'undefined'),
        modules: concatenatedModules === null || concatenatedModules === void 0 ? void 0 : concatenatedModules.map((concatenatedModule) => ({
            name: concatenatedModule.name,
            size: concatenatedModule.size,
        })),
    }));
    return {
        builtAt,
        hash,
        assets,
        entrypoints,
        chunks,
        modules,
    };
};
//# sourceMappingURL=index.js.map